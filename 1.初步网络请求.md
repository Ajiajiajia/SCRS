# ç½‘ç»œè¯·æ±‚

ä»¥å†™ä¸€ä¸ªâ€œç™»å½•â€ä¸ºä¾‹

![åç«¯çš„Githubæ–‡æ¡£](https://github.com/maoqiu123/saiyou)

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-19/45096949.jpg)

## å‰æå°æ¦‚å¿µ

### JSON--æ•°æ®ä¼ è¾“æ ¼å¼

+ å¯ä»¥ç†è§£ä¸ºStringç±»å‹ï¼Œå› ä¸ºéœ€è¦åœ¨APIResponceä¸­æ³¨æ˜
+ å®Œæ•´çš„JSONåŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†(å¦‚å›¾æ‰€ç¤º)
	+ code
	+ msg
	+ date

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-19/66360796.jpg)

### Postmançš„ä¸€æŠŠçˆ½ä½“éªŒï¼ˆä¸€ä¸å°å¿ƒæŠŠåç«¯æå´©äº†.....ç¾æ¶©ï¼‰

+ GET
	+ ç½‘å€çš„åé¢è¿˜éœ€è¦åŠ ä¸Šâ€œ?+ç›¸å…³ä¿¡æ¯â€

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-19/88042533.jpg)

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-19/31408368.jpg)

---

+ Post
	+ ä¸Šä¼ çš„itemå¿…é¡»æ˜¯JSONä¸­æœ‰çš„ï¼Œä¸ç„¶é€ æˆç©ºæŒ‡é’ˆç°è±¡ï¼Œå¯¼è‡´å´©ç›˜

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-19/130368.jpg)

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-19/87879007.jpg)

## APIService.java

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-19/5758609.jpg)

```
public interface APIService {

    /**
     * ç™»å½•
     */
    @POST("saiyou/public/index.php/login")
    Call<APIResponse> login(@Body LoginRequest loginRequest);


}

```

+ @POST  æ‹¬å·å†…ä¸ºå¯¹åº”ç½‘å€çš„å±€éƒ¨
+ @Body  åé¢è·Ÿç€Javaç±»çš„å¼•ç”¨ï¼Œå› ä¸ºåé¢çš„LoginRequestæ˜¯ä¸€ä¸ªæ–°çš„ç±»
+ call
	+ è¯¥æ–¹æ³•å°†è¯·æ±‚å‘é€åˆ°webserverå¹¶è¿”å›å“åº”
	+ APIResponse è§ä¸‹ä¸‹ä¸€ä¸ªæ ‡é¢˜ æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„Activity
	+ login è¿™ä¸ªå±äºç½‘ç»œè¯·æ±‚ï¼Œåœ¨LoginActivity.javaä¸­çš„processLoginå‡½æ•°ä¼šç”¨åˆ°


## LoginRequest.java

+ ç›¸å½“äºä¸ºBodyå»ºç«‹ä¸€ä¸ªæ¡†æ¶
+ è®¾ç½®æ¸…æ™°æ¯ä¸€ä¸ªitem çš„get å’Œsetæ–¹æ³•
+ è¿™ä¸ª get å’Œ setæ–¹æ³•æ˜¯è‡ªå·±å†™çš„ï¼Œä¸æ˜¯æ‹“å±•è‡ªå·±æ¥çš„
+ åœ¨ LoginActivity.javaæ–‡ä»¶ä¸­å°±ä¼šç”¨åˆ°setï¼Œç”¨çš„æ—¶å€™ç›´æ¥åƒè¿™æ ·
	+ ç”¨çš„æ—¶å€™ç›´æ¥åƒè¿™æ ·

	LoginRequest request = new LoginRequest();//å…ˆå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡
        request.setIdentifier('defhewkdhkeh"');

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-19/85020026.jpg)

```
public class LoginRequest extends BaseModel {
    
    private String phone;
    private String password;

    public LoginRequest() {

    }

    public String getIdenttifier(){
        return phone;
    }

    public void serIdentifier(String phone){
        this.phone=phone;
    }

    public String getPassword(){
        return password;
    }
    
    public void setPassword(String password){
        this.password=password;
    }
    
}

```

# APIResponse.java

+ æ•°æ®ä¼ è¾“æ ¼å¼JSONä¸­ï¼Œä¸‰å¤§é‡è¦ç»„æˆ
	+ msg
	+ code
	+ date

```

public class APIResponse<T> extends BaseModel {
    
    private int code = -2;
    private T data;
    private String msg="";

    public String getMsg(){
        return msg;
    }

    public void setMsg(String msg){
        this.msg=msg;
    }

    public int getCode() {
        return code;
    }

    public void setCode(int code) {
        this.code = code;
    }

    public T getData() {
        return data;
    }

    public void setData(T data) {
        this.data = data;
    }
}

```

ã€æ³¨æ„ï¼šã€‘ç”±äºdate çš„å†…å®¹å¾ˆå¤šå¾ˆæ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ è¿›å»çš„æ˜¯ä¸€ä¸ªèŒƒå½¢T

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-19/42074394.jpg)

## LoginActivity.java 

### åœ¨initVariable(){}é‡Œ:

+ initVariable()ä½œç”¨ï¼šåˆå§‹åŒ–å˜é‡
+ éœ€è¦å®ä¾‹åŒ–LoginRequestå¯¹è±¡

### æˆ‘ä»¬å…¶å®æ˜¯æŠŠä¸€æ•´ä¸ªè¿‡ç¨‹çš„å¤–éƒ¨æ¡†æ¶ï¼Œæ”¾åœ¨æŒ‰é’®çš„ç‚¹å‡»é‡Œé¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æ­¥æ‹†åˆ†ï¼š

```
    /**
     * ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶--ç™»å½•
     */
    @OnClick(R.id.btn_login)
    public void onBtnLoginClicked() {
        
        loginRequest.setIdentifier(editIdentifier.getText().toString().trim());
        loginRequest.setPassword(editPassword.getText().toString().trim());

        if(isDateTrue()){

            processLogin();
        }
    }
```

+ loginRequestä¸ä»…ä»…éœ€è¦   å£°æ˜ + å®ä¾‹åŒ–
	+ å£°æ˜```   private LoginRequest loginRequest  ```
	+ å®ä¾‹åŒ–```    protected void initVariable() {loginRequest = new LoginRequest();}
```

+ loginRequest.setIdentifier(editIdentifier.getText().toString().trim());

å…¶å®å°±æ˜¯ç®€å•çš„ è°ƒç”¨ å®ä¾‹åŒ–ç±»åçš„å¯¹è±¡ çš„ é‡Œé¢çš„æ–¹æ³• ï¼ˆåœ¨LoginRequest.javaé‡Œé¢ï¼Œæˆ‘ä»¬è®¾ç½®äº†çš„setIdentifieræ–¹æ³•ï¼Œè§ä¸‹å›¾ğŸ‘‡ï¼‰

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-21/80555260.jpg)

+ è¿™é‡Œé¢å‰©ä¸‹çš„å°±æ˜¯å¥—è·¯ é‡Œé¢ç´«è‰²éƒ¨åˆ†æ˜¯ä¹‹å‰Bindviewçš„å†…å®¹

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-21/94815762.jpg)

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-21/43947441.jpg)

![](http://oz3rf0wt0.bkt.clouddn.com/17-12-21/94833647.jpg)

+ getText()æ³¨æ„ï¼ï¼ï¼
	+ context æ˜¯ç³»ç»Ÿä¸Šä¸‹æ–‡çš„æ„æ€
	+ textæ‰æ˜¯é‡Œé¢çš„æ–‡æœ¬
	+ getContext()è¿”å›çš„æ˜¯ä¸€ä¸ªContextï¼Œç›¸å½“äºæ•´ä¸ªç•Œé¢å†…çš„å†…å®¹ï¼Œè·ŸEditTexté‡Œé¢çš„å€¼æ¯«æ— å…³ç³»ï¼Œè€ŒTextå¾—åˆ°çš„æ‰æ˜¯EditText
+ toString()
	+ è¿”å›ä¸€ä¸ªåŒ…å«è¯¥åºåˆ—ä¸­çš„å­—ç¬¦çš„å­—ç¬¦ä¸²
+ isDateTrue()è§ä¸‹ğŸ‘‡-- éªŒè¯ç”¨æˆ·è¾“å…¥æ˜¯å¦æ­£ç¡®
+ processLoginï¼ˆï¼‰è§ä¸‹ğŸ‘‡--è¿›è¡Œç™»å½•çš„ç›¸å…³æ“ä½œ--ç½‘ç»œè¯·æ±‚

## isDateTrueæ–¹æ³•ï¼ˆå‡½æ•°ï¼‰--LoginActivity.java

éªŒè¯ç”¨æˆ·è¾“å…¥æ˜¯å¦æ­£ç¡®

```
    /**
     * éªŒè¯ç”¨æˆ·è¾“å…¥æ˜¯å¦æ­£ç¡®
     * @return   æ­£ç¡®ä¸ºtrue
     */
    public boolean isDateTrue() {

            boolean flag = true;

            if(editIdentifier.getText().toString().trim().equals(Config.EMPTY_FIELD)){
                showError(editIdentifier,getString(R.string.error_account_empty_illegal));
                flag=false;
            }
            else if (!RegexUtil.checkMobile(editIdentifier.getText().toString().trim())) {
                showError(editIdentifier, getString(R.string.error_phone_number_illegal));
                flag = false;
            }
            else if (editPassword.getText().toString().trim().length() < Config.PASSWORD_MIN_LIMIT) {
                showError(editPassword,getString(R.string.error_password_min_limit) );
                flag = false;
            }
            else if (editPassword.getText().toString().trim().length() > Config.PASSWORD_MAX_LIMIT) {
                showError(editPassword, getString(R.string.error_password_max_limit));
                flag = false;
            }
        return flag;
    }
}
```


### equals()--å°†è¯¥å­—ç¬¦ä¸²ä¸æŒ‡å®šçš„å¯¹è±¡è¿›è¡Œæ¯”è¾ƒ

+ è¯¥æ–¹æ³•æ˜¯å®šä¹‰åœ¨String.javaä¸­ï¼Œç„¶ååœ¨æ­¤è°ƒç”¨

```
    public boolean equals(Object anObject) {
        if (this == anObject) {
            return true;
        }
        if (anObject instanceof String) {
            String anotherString = (String) anObject;
            int n = count;
            if (n == anotherString.count) {
                int i = 0;
                while (n-- != 0) {
                    if (charAt(i) != anotherString.charAt(i))
                            return false;
                    i++;
                }
                return true;
            }
        }
        return false;
    }
    
```

+ Configçš„å®šä¹‰(Config.java)


```
    /**
     * ç©ºå­—æ®µ
     */
    public static final String EMPTY_FIELD = "";
    
        /**
     * å¯†ç é•¿åº¦é™åˆ¶
     */
    public static final int PASSWORD_MIN_LIMIT =6;
    public static final int PASSWORD_MAX_LIMIT =16;


    public static final String KEY_MAIN_FLAG = "keyMainFlag";


```

+ Stringçš„å®šä¹‰(String.java)

```
    <string name="error_account_empty_illegal">è´¦å·ä¸å¯ä¸ºç©º</string>
    <string name="error_phone_number_illegal">æ‰‹æœºå·ä¸åˆæ³•</string>
    <string name="error_password_min_limit">å¯†ç ä¸å¾—å°‘äº6ä½</string>
    <string name="error_password_max_limit">å¯†ç ä¸å¾—å¤šäº16ä½</string>
    <string name="dialog_wait_moment">è¯·ç¨å</string>
    <string name="toast_login_successful">ç™»å½•æˆåŠŸ</string>



```

+ RegexUtilaæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‰‹æœºå·æ˜¯å¦è¾“å…¥æ­£ç¡®çš„åˆ¤æ–­ï¼ˆRegexUtil.javaï¼‰

```
public class RegexUtil {
    //æ‰‹æœºå·æ­£åˆ™
    public static boolean checkMobile(String phone) {
        return Pattern.matches(Config.MOBILE_REGEX, phone);
    }

    //éªŒè¯é‚®ç®±
    public static boolean checkEmail(String email){
        return Pattern.matches(Config.EMAIL_REGEX,email);
    }
}

```

## showErroræ–¹æ³•ï¼ˆå‡½æ•°ï¼‰--LoginActivity.java

+ ç”¨äºTextInputEditTextæ§ä»¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

```
    /**
     * ç”¨äºTextInputEditTextæ§ä»¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
     *
     * @param textInputEditText æ§ä»¶å¯¹è±¡
     * @param error             é”™è¯¯ä¿¡æ¯--æˆ‘ä»¬å¯è‡ªå®šä¹‰
     */

    private void showError(TextInputEditText textInputEditText, String error) {
        textInputEditText.setError(error);
        textInputEditText.setFocusable(true);
        textInputEditText.setFocusableInTouchMode(true);
        textInputEditText.requestFocus();
    }

```

###  TextInputEditText

+ ä½¿ç”¨è¿™ä¸ªç±»å¯ä»¥è®©æˆ‘ä»¬åœ¨â€œhintâ€æ¨¡å¼ä¸‹æ˜¾ç¤ºä¸€ä¸ªæç¤º

## processLoginæ–¹æ³•ï¼ˆå‡½æ•°ï¼‰--LoginActivity.java

å½“æˆ‘ä»¬å°†è´¦å·å’Œå¯†ç è¾“å…¥->è¾“å…¥å‡æ­£ç¡®->è¿›å…¥ç½‘ç»œè¯·æ±‚


```
    /**
     * è¿›è¡Œç™»å½•çš„ç›¸å…³æ“ä½œçš„æ–¹æ³•
     */
    private void processLogin() {
        //å¼¹å‡ºprogressDialog
        progressDialog.setMessage(getString(R.string.dialog_wait_moment));
        progressDialog.show();

        //ç½‘ç»œè¯·æ±‚
        RestClient.getService().login(loginRequest).enqueue(new DataCallback<APIResponse>() {

            //è¯·æ±‚æˆåŠŸæ—¶å›è°ƒ
            @Override
            public void onDataResponse(Call<APIResponse> call, Response<APIResponse> response) {


                //ç™»å½•æˆåŠŸè®°å½•è´¦å·å’Œå¯†ç 
                phonenumber=editIdentifier.getText().toString().trim();
                password=editPassword.getText().toString().trim();
                ToastUtil.showToast(getString(R.string.toast_login_successful));


                //è·³è½¬è‡³MainActivity
                Intent intent = new Intent(LoginActivity.this, MainActivity.class);
                startActivity(intent);
                finish();
            }

            //è¯·æ±‚å¤±è´¥æ—¶å›è°ƒ
            @Override
            public void onDataFailure(Call<APIResponse> call, Throwable t) {

            }

            //æ— è®ºæˆåŠŸæˆ–è€…å¤±è´¥æ—¶éƒ½å›è°ƒï¼Œç”¨äºdismissDialogæˆ–éšè—å…¶ä»–æ§ä»¶
            @Override
            public void dismissDialog() {
                if (progressDialog.isShowing()) {
                    disMissProgressDialog();
                }
            }
        });

    }
```

+ åœ¨æ­¤å¤„è°ƒç”¨ login ï¼ˆAPIServiceé‡Œé¢çš„ç½‘ç»œè¯·æ±‚Postï¼‰
+ åœ¨ä¹‹å‰å°±å®šä¹‰ä¸¤ä¸ªé™æ€å˜é‡

```
    public static String password;
    public static String phonenumber;
```
## æ³¨æ„æ³¨æ„ï¼

+ BaseURLéœ€åœ¨Configé‡Œé¢è¿›è¡Œæ›´æ”¹	
	+ ä¸åç«¯ç»™å‡ºçš„githubç›¸å¯¹

	![](http://oz3rf0wt0.bkt.clouddn.com/17-12-21/74009438.jpg)

```
    /**
     * APP Server ç½‘ç»œè¯·æ±‚BaseUrl
     */
    public static final String APP_SERVER_BASE_URL = "http://www.thmaoqiu.cn/";

```